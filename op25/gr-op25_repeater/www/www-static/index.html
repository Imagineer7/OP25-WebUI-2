<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#111" />

  <title>OP25</title>
  <link rel="stylesheet" href="main.css" />
  <script defer src="main.js"></script>

  <!--
    Modernized index.html for OP25 (boatbod).
    Notes:
    • No functional IDs were changed, so existing JS (main.js) should keep working.
    • Duplicate id "btn-new-settings" resolved: About link now has id="btn-about".
    • Removed most inline styles in favor of classes / existing CSS.
    • Added semantic structure (header/nav/main/aside/footer), ARIA labels, and a skip-link.
    • Responsive behavior relies on existing CSS variables and media queries in main.css.
  -->
</head>
<body onload="do_onload();">
  <a class="sr-only" href="#main" style="position:absolute;left:-10000px;top:auto;width:1px;height:1px;overflow:hidden;">Skip to main content</a>

  <header class="top-nav-container" role="banner">
    <div class="top-nav" role="navigation" aria-label="Primary">
      <div class="nav-left">
        <a href="#" class="nav-item" id="btn-home" onclick="showHome();">Home</a>
        <a href="#" class="nav-item" id="btn-plot" onclick="toggleDivById('plot-container', 'btn-plot')">Plot</a>
        <a href="#" class="nav-item" id="btn-new-settings"
           onclick="event.preventDefault(); event.stopPropagation(); togglePopup('settingsPopupContainer', true);">Settings</a>
        <a href="#" class="nav-item" id="btn-config" onclick="localStorage.setItem('getConfigBtn', 1); send_command('get_full_config');">View Config</a>
        <a href="legacy-index.html" class="nav-item" id="btn-legacy">Legacy UI</a>
        <a href="#" class="nav-item" id="btn-about"
           onclick="event.preventDefault(); event.stopPropagation(); togglePopup('aboutPopupContainer', true);">About</a>
      </div>
      <div class="nav-right" aria-hidden="true">
        <!-- SVG Logo -->
        <svg class="logo" viewBox="0 0 300 100" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="OP25 boatbod logo">
          <rect width="300" height="100" fill="#222" rx="10" />
          <polygon points="50,70 70,30 90,70" fill="#66aaff" />
          <rect x="50" y="70" width="40" height="5" fill="#ffaa55" rx="2" />
          <text x="110" y="50" fill="#ffffff" font-size="32" font-family="Arial, sans-serif" font-weight="bold">O P 2 5</text>
          <text x="110" y="75" fill="#ccc" font-size="24" font-family="Arial, sans-serif">b o a t b o d</text>
        </svg>
      </div>
    </div>

    <div class="warning-box" id="warning-box" role="alert" aria-live="polite">
      <span id="icon" aria-hidden="true">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="#f44336" xmlns="http://www.w3.org/2000/svg">
          <path d="M1 21h22L12 2 1 21z"/>
          <path d="M13 16h-2v2h2v-2zm0-6h-2v4h2v-4z" fill="#fff"/>
        </svg>
      </span>
      <span id="warning-text"></span>
    </div>
  </header>

  <!-- About Popup -->
  <div id="aboutPopupContainer" aria-hidden="true" aria-label="About OP25" role="dialog">
    <div class="about-popup-content" role="document">
      <div class="popup-header">
        <svg class="logo-lg" viewBox="0 0 300 100" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="OP25 boatbod logo">
          <rect width="300" height="100" fill="#333" rx="10" />
          <polygon points="50,70 70,30 90,70" fill="#66aaff" />
          <rect x="50" y="70" width="40" height="5" fill="#ffaa55" rx="2" />
          <text x="110" y="50" fill="#ffffff" font-size="32" font-family="Arial, sans-serif" font-weight="bold">O P 2 5</text>
          <text x="110" y="75" fill="#ccc" font-size="24" font-family="Arial, sans-serif">b o a t b o d</text>
        </svg>
        <button class="close-icon" aria-label="Close about" onclick="togglePopup('aboutPopupContainer', false);" style="background:none;border:0;padding:0;">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="popup-body">
        <div class="about-content">
          <p class="copyr">&copy; 2017–2025 Max H. Parke &amp; Graham J. Norbury [boatbod version]<br>UI Updates, Michael Rose — Last UI Update: <span id="lastUiUpdate">-</span></p>
          <p>This program comes with <strong>ABSOLUTELY NO WARRANTY</strong>.</p>
          <p>OP25 is free software, and you are welcome to redistribute it under certain conditions. For further details refer to the "License" link below.</p>
          <p><strong>License:</strong> <a href="https://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPLv3 License</a></p>
          <p><strong>Download:</strong><br>
            <code>git clone https://git.osmocom.org/op25</code> &nbsp;<a href="https://gitea.osmocom.org/op25/op25?h=master" target="_blank" rel="noopener">[original]</a><br>
            <code>git clone https://github.com/boatbod/op25</code> &nbsp;<a href="https://github.com/boatbod/op25" target="_blank" rel="noopener">[boatbod fork]</a>
          </p>
          <p><strong>Website:</strong> <a href="http://op25.osmocom.org" target="_blank" rel="noopener">http://op25.osmocom.org</a></p>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings Popup -->
  <div id="settingsPopupContainer" aria-hidden="true" aria-label="UI Settings" role="dialog">
    <div class="settings-popup-content" role="document">
      <div class="popup-header">
        <h2 style="margin:0;font-size:1.1rem;">UI Settings</h2>
        <button class="close-icon" aria-label="Close settings" onclick="togglePopup('settingsPopupContainer', false);" style="background:none;border:0;padding:0;">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>

      <div class="popup-body">
        <table id="settings-container" style="text-align:left;margin-top:10px;">
          <tr><td colspan="2" style="padding:0;">All settings are automatically saved to the browser.<br><br></td></tr>
          <tr>
            <!-- LEFT COLUMN -->
            <td style="vertical-align:top;width:50%;padding-right:20px;padding:0;border-right:1px solid grey;">
              <div style="margin-bottom:10px;">
                <button class="small-button" id="s2_ch_dmp" onclick="f_dump_button(0);" title="Log talkgroups to stderr2">Log Talkgroups</button>
                <button class="small-button" id="s2_ch_dumpbuf" onclick="f_dump_buffer(-1);" title="Dump buffer">Dump Buffer</button>
              </div>
              <div style="margin-bottom:10px;">
                <button class="small-button" onclick="f_scan_button('set_debug');" title="Set logging level">Log Verbosity</button>
              </div>
              <div class="s2_cell_h" id="s2_ch_cap" style="margin-bottom:10px;">
                <button class="small-button" id="cap_bn" onclick="f_cap_button(0);">Start Capture</button>
              </div>
              <div style="margin-bottom:10px;">
                <button class="small-button" onclick="f_scan_button('lockout');">Blacklist TGID</button>
                <button class="small-button" onclick="f_scan_button('whitelist');">Whitelist TGID</button>
              </div>
              <div style="margin-bottom:15px;">
                <label for="callHeightControl" style="color:#ccc;">Call History Height (px):</label><br>
                <input type="number" id="callHeightControl" min="200" max="1000" value="500" style="width:80px;">
              </div>
              <div style="margin-bottom:15px;">
                <label for="plotSizeControl" style="color:#ccc;">Plot Image Width (px):</label><br>
                <input type="number" id="plotSizeControl" min="100" max="1000" value="300" style="width:80px;">
              </div>
              <div style="margin-bottom:15px;">
                <label for="valueColorPicker">Accent Color:</label>
                <input type="color" id="valueColorPicker" value="#00ffff">
                <button id="resetColor" class="small-button" style="width:60px;">Default</button>
              </div>
            </td>
            <!-- RIGHT COLUMN -->
            <td style="vertical-align:top;width:50%;padding-left:20px;">
              <div style="margin-bottom:15px;">
                <label for="smartColorToggle" style="color:#ccc;">
                  <input type="checkbox" id="smartColorToggle" checked>
                  Enable Smart Colors
                </label>
              </div>
              <div style="margin-bottom:15px;">
                <label for="radioIdFreqTable" style="color:#ccc;">
                  <input type="checkbox" id="radioIdFreqTable">
                  Show Radio ID in Frequency Table
                </label>
              </div>
              <div style="margin-bottom:15px;">
                <label for="showBandPlan" style="color:#ccc;">
                  <input type="checkbox" id="showBandPlan" checked>
                  Show P25 Band Plan
                </label>
              </div>
              <div style="margin-bottom:15px;">
                <label for="adjacentSitesToggle" style="color:#ccc;">
                  <input type="checkbox" id="adjacentSitesToggle" checked>
                  Show Adjacent Sites
                </label>
              </div>
              <div style="margin-bottom:15px;">
                <label for="channelsTableToggle" style="color:#ccc;">
                  <input type="checkbox" id="channelsTableToggle" checked>
                  Show Channels Table
                </label>
              </div>
              <div style="margin-bottom:15px;">
                <label for="callHistoryToggle" style="color:#ccc;">
                  <input type="checkbox" id="callHistoryToggle" checked>
                  Show Call History
                </label>
              </div>
              <div style="margin:5px 0;text-align:left;">
                <label for="callHistorySource" style="color:#ccc;">Call History Source:</label>
                <select id="callHistorySource" style="margin-left:5px;">
                  <option value="frequency">Frequency Data</option>
                  <option value="voice">Voice Grant (Python)</option>
                  <option value="display">Main Display</option>
                </select>
              </div>
              <div style="margin-top: 12px;">
                <label style="color:#ccc;">Talkgroup Color:</label><br>
                <input id="tgColorId" type="number" placeholder="TGID" style="width:90px;">
                <input id="tgColorPicker" type="color" value="#66aaff">
                <button class="small-button" id="tgColorSave">Save</button>
                <button class="small-button" id="tgColorClear">Clear</button>
              </div>
              <!-- ========== Color Customization ========== -->
              <hr style="margin:12px 0;">
              <div class="settings-section" style="margin-bottom:10px;">
                <h3 style="margin:6px 0 8px;">Colors</h3>

                <div class="form-grid" style="display:grid;grid-template-columns: 1fr auto;gap:8px;align-items:center;">
                  <label for="uiAccent" style="color:#ccc;">UI Accent</label>
                  <input type="color" id="uiAccent" value="#00ffff" />

                  <label for="headerBg" style="color:#ccc;">Header Background</label>
                  <input type="color" id="headerBg" value="#1e1e1e" />
                  <label for="headerFg" style="color:#ccc;">Header Text</label>
                  <input type="color" id="headerFg" value="#e6e6e6" />

                  <label for="cardBg" style="color:#ccc;">Card Background</label>
                  <input type="color" id="cardBg" value="#151515" />
                  <label for="cardFg" style="color:#ccc;">Card Text</label>
                  <input type="color" id="cardFg" value="#dcdcdc" />

                  <label for="bandingColor" style="color:#ccc;">Row Banding</label>
                  <input type="color" id="bandingColor" value="#202020" />
                </div>

                <div class="settings-row" style="margin-top:10px;display:flex;align-items:center;gap:8px;">
                  <label for="tgGlowStrength" style="color:#ccc;min-width:140px;">Talkgroup Glow</label>
                  <input type="range" id="tgGlowStrength" min="0" max="24" step="1" value="10" />
                  <span id="tgGlowStrengthValue" style="min-width:24px;text-align:right;">10</span><span style="color:#aaa;">px</span>
                </div>

                <div class="settings-row" style="margin-top:6px;display:flex;align-items:center;gap:8px;">
                  <label for="tgGlowStyle" style="color:#ccc;min-width:140px;">Glow Style</label>
                  <select id="tgGlowStyle">
                    <option value="outline">Outline</option>
                    <option value="softfill">Soft Fill</option>
                  </select>
                </div>

                <div class="settings-row" style="gap: 8px; margin-top: 12px; display:flex; flex-wrap:wrap;">
                  <button id="exportColorsBtn" class="small-button">Export Color Profile</button>
                  <input id="importColorsInput" type="file" accept="application/json" style="display:none" />
                  <button id="importColorsBtn" class="small-button">Import Color Profile</button>
                  <button id="resetColorsBtn" class="small-button danger">Reset to Defaults</button>
                </div>
              </div>
              <!-- ========== /Color Customization ========== -->
              <div style="margin-bottom:10px;color:#ccc;">Stream URL: <span id="streamURL">None</span></div>
              <hr style="margin:10px 0;">
              <div id="div_debug" style="font-size:0.8em;"><strong>Debug Log</strong></div>
            </td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <!-- Server Config Popup -->
  <div id="popupContainer" class="popup-container" aria-hidden="true" aria-label="Server Side Configuration" role="dialog">
    <div class="popup-content" role="document" style="display:flex;flex-direction:column;height:80vh;width:70vw;">
      <div class="popup-header">
        <h2 style="margin:0;font-size:1.1rem;">Server Side Configuration</h2>
        <button class="close-icon" aria-label="Close configuration" onclick="togglePopup('popupContainer', false);" style="background:none;border:0;padding:0;">
          <svg xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div id="configDisplay" class="config-container" style="overflow-y:auto;flex:1;padding:10px;">Configuration...</div>
    </div>
  </div>

  <main id="main">
    <div class="row">
      <!-- START FIRST COLUMN -->
      <section class="column" aria-label="Primary controls and status">
        <div class="card">
          <table class="outer-table" id="main-display" role="presentation">
            <tr>
              <!-- Left panel: vertical buttons -->
              <td class="left-panel">
                <button class="button-3d" onclick="f_scan_button('skip'); this.blur();">SCAN</button><br>
                <button class="button-3d" id="btn-hold" onclick="f_scan_button('hold'); this.blur();">HOLD</button><br>
                <button class="button-3d" onclick="f_scan_button('lockout'); this.blur();">LOCKOUT</button><br>
                <button class="button-3d" onclick="f_scan_button('goto'); this.blur();">GO TO</button><br>
              </td>

              <!-- Main info area -->
              <td class="main-info">
                <table class="inner-table table-gradient-bg" role="grid" aria-label="Current system status">
                  <tr>
                    <td><span class="info-large" id="displaySystem">Waiting for data...</span></td>
                    <td style="text-align:center;white-space:nowrap;width:1%;">
                      <span class="small-label">Frequency</span><br>
                      <span class="trunk-value" id="displayFreq">----</span>
                    </td>
                  </tr>
                  <tr>
                    <td><span class="info-large" id="displayTalkgroup"></span></td>
                    <td style="text-align:center;white-space:nowrap;width:1%;">
                      <span class="small-label">Talkgroup</span><br>
                      <span class="trunk-value" id="displayTgid">----</span>
                    </td>
                  </tr>
                  <tr>
                    <td><span class="info-large" id="displaySource"></span></td>
                    <td style="text-align:center;white-space:nowrap;width:1%;">
                      <span class="small-label">Source</span><br>
                      <span class="trunk-value" id="displaySourceId">----</span>
                    </td>
                  </tr>
                  <tr>
                    <td colspan="2" style="padding:8px 0;text-align:center;">
                      <span class="small-label">Encryption:</span> <span class="small-value" id="displayEnc">-</span>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      <span class="small-label">Emergency:</span> <span class="small-value" id="displayEmg">-</span>
                      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                      <span class="small-label">Service:</span> <span class="small-value" id="displayService">-</span>
                    </td>
                  </tr>
                </table>
              </td>

              <!-- Right panel: tuning and stream -->
              <td class="right-logo">
                <span class="small-label">Channel</span><br>
                <input type="button" class="tune-button" name="c_dn" id="ch-dn" value="↓" title="Prev Channel" onclick="f_chan_button(-1);">
                <input type="button" class="tune-button" name="c_up" id="ch-up" value="↑" title="Next Channel" onclick="f_chan_button(1);">
                <br>
                <span class="small-value" id="displayChannel">-</span><br>
                <span id="streamButton" style="display:inline-block;margin:10px;"></span>
                <audio id="op25Audio" preload="none" controls style="width:100%;max-width:220px;"></audio>
                <br>
                <span class="small-label">Tuning</span><br>
                <input type="button" class="tune-button" id="tune1" onclick="this.blur(); f_tune_button('ld')" value="≪">
                <input type="button" class="tune-button" id="tune2" onclick="this.blur(); f_tune_button('sd')" value="&lt;">
                <input type="button" class="tune-button" id="tune3" onclick="this.blur(); f_tune_button('su')" value="&gt;">
                <input type="button" class="tune-button" id="tune4" onclick="this.blur(); f_tune_button('lu')" value="≫">
                <br>
                <span class="small-label">Error:</span> <span class="small-value" id="errorVal">-</span>
              </td>
            </tr>
            <tr>
              <td colspan="3" class="bottom-buttons" id="presetButtons" style="display:none;">
                <button id="preset-btn-1" onclick="this.blur(); f_preset(1)">Preset 1</button>
                <button id="preset-btn-2" onclick="this.blur(); f_preset(2)">Preset 2</button>
                <button id="preset-btn-3" onclick="this.blur(); f_preset(3)">Preset 3</button>
                <button id="preset-btn-4" onclick="this.blur(); f_preset(4)">Preset 4</button>
                <button id="preset-btn-5" onclick="this.blur(); f_preset(5)">Preset 5</button>
                <button id="preset-btn-6" onclick="this.blur(); f_preset(6)">Preset 6</button>
              </td>
            </tr>
          </table>
        </div>

        <div class="card">
          <table class="outer-table" id="channels-container" role="presentation" style="text-align:left;">
            <tr>
              <th class="th-section" colspan="2" style="padding:0;">
                <div style="display:flex;justify-content:space-between;align-items:center;padding:4px 8px;">
                  <span id="channes-container-title" style="flex:1;text-align:center;">Channels</span>
                </div>
              </th>
            </tr>
            <tr>
              <td>
                <div id="channelInfo"><!-- Channel Info Table --></div>
              </td>
            </tr>
          </table>
        </div>

        <div class="card">
          <div class="table-responsive">
            <table class="outer-table" role="presentation">
              <tr>
                <td>
                  <div id="frequenciesTable"></div>
                </td>
              </tr>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="table-responsive">
            <table class="outer-table" id="adjacentSitesContainer" role="presentation">
              <tr>
                <td>
                  <div id="adjacentSitesTable"></div>
                </td>
              </tr>
            </table>
          </div>
        </div>

        <div class="card">
          <div class="table-responsive">
            <table class="outer-table" id="patchesContainer" role="presentation">
              <tr>
                <td>
                  <div id="patchesTable"></div>
                </td>
              </tr>
            </table>
          </div>
        </div>
      </section>
      <!-- END FIRST COLUMN -->

      <!-- START SECOND COLUMN -->
      <aside class="column" id="second-column" aria-label="History and plots">
        <div class="card">
          <div class="table-responsive">
            <table class="outer-table" id="callHistoryContainer" role="presentation">
              <tr>
                <th class="th-section" colspan="2" style="padding:0;">
                  <div style="display:flex;justify-content:space-between;align-items:center;padding:4px 8px;">
                    <span id="callHistoryTableTitle" style="flex:1;text-align:center;">Call History</span>
                    <button onclick="csvTable()" title="Save Call History to CSV" style="background:none;border:none;cursor:pointer;padding:0;margin-left:auto;">
                      <svg xmlns="http://www.w3.org/2000/svg" height="20" width="20" viewBox="0 0 24 24" fill="#ccc" aria-hidden="true">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zm0 2.5L18.5 7H17V5.5zM5 19V5h10v4h4v10H5z"/>
                        <path d="M12 17a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/>
                      </svg>
                    </button>
                  </div>
                </th>
              </tr>
              <tr>
                <td>
                  <div class="call-history-scroll">
                    <table class="compact-table" id="callHistory" aria-label="Recent calls">
                      <thead>
                        <tr><th>Time</th><th>Sys</th><th>Frequency</th><th colspan="2">Talkgroup</th><th>Source</th></tr>
                      </thead>
                      <tbody id="callHistoryBody"><!-- Filled by JS --></tbody>
                    </table>
                  </div>
                </td>
              </tr>
            </table>
          </div>
        </div>

        <div class="card" id="plot-card">
          <table class="outer-table" id="plot-container" role="presentation" style="display:none;">
            <tr><th class="th-section">Plots</th></tr>
            <tr>
              <td>
                <div id="plot-controls" style="text-align:center;width:100%;">
                  <input type="button" class="small-button" style="width:100px;" id="pb-fft" value="Spectrum" title="Toggle Spectrum Plot" onclick="f_plot_button(1);">
                  <input type="button" class="small-button" style="width:100px;" id="pb-constellation" value="Constellation" title="Toggle Constellation Plot" onclick="f_plot_button(2);">
                  <input type="button" class="small-button" style="width:100px;" id="pb-symbol" value="Symbol" title="Toggle Symbol Plot" onclick="f_plot_button(3);">
                  <input type="button" class="small-button" style="width:100px;" id="pb-eye" value="Datascope" title="Toggle Datascope Plot" onclick="f_plot_button(4);">
                  <input type="button" class="small-button" style="width:100px;" id="pb-mixer" value="Mixer" title="Toggle Mixer Plot" onclick="f_plot_button(5);">
                  <input type="button" class="small-button" style="width:100px;" id="pb-fll" value="Tuner" title="Toggle Tuner Plot" onclick="f_plot_button(6);">
                  <br>
                  <span class="small-label">Plots in data stream:</span> <span class="small-value" id="plotsCount">-</span>
                  &nbsp;&nbsp;&nbsp;&nbsp;
                  <span class="small-label">Channel:</span> <span class="small-value" id="plotChannelDisplay">-</span>
                </div>

                <div id="div_plot" style="display:block;text-align:center;width:100%;">
                  <img src="1x1.png" class="plot-image" id="img0" style="display:none" alt="plot 0">
                  <img src="1x1.png" class="plot-image" id="img1" style="display:none" alt="plot 1">
                  <img src="1x1.png" class="plot-image" id="img2" style="display:none" alt="plot 2">
                  <img src="1x1.png" class="plot-image" id="img3" style="display:none" alt="plot 3">
                  <img src="1x1.png" class="plot-image" id="img4" style="display:none" alt="plot 4">
                  <img src="1x1.png" class="plot-image" id="img5" style="display:none" alt="plot 5">
                </div>
              </td>
            </tr>
          </table>
        </div>
      </aside>
      <!-- END SECOND COLUMN -->
    </div>
  </main>

  <footer style="width:var(--ui-col-width);margin:10px 0;color:#777;font-size:.8rem;">
    <span>OP25 Web UI</span>
  </footer>
</body>
</html>
