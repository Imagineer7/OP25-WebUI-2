/* Light theme overrides */
:root[data-theme="light"] {
  --bg: #f7f8fa;
  --fg: #222;
  --muted: #526181;
  --card: #fff;
  --band: #e9eaf0;
  --accent: #0078d7;
}
:root[data-theme="light"] .card,
:root[data-theme="light"] .popup-card {
  color: #222;
  background: #fff;
  border-color: #d3d7e3;
}
:root[data-theme="light"] .topbar {
  background: #e9eaf0;
  border-bottom: 1px solid #d3d7e3;
  color: #222;
}
:root[data-theme="light"] .badge,
:root[data-theme="light"] .status {
  background: #e9eaf0;
  color: #0078d7;
  border-color: #0078d7;
}
:root[data-theme="light"] .badge.live {
  background: #e6ffe6;
  color: #228822;
  border-color: #228822;
}
:root[data-theme="light"] .badge.idle {
  background: #f3f3f3;
  color: #6a6f7a;
  border-color: #bbb;
}
:root[data-theme="light"] .badge-name {
  background: #e9eaf0;
  color: #0078d7;
  border-color: #0078d7;
  box-shadow: 0 0 8px 2px #0078d733;
}
:root[data-theme="light"] .popup-card b {
  color: #0078d7;
}
:root[data-theme="light"] .popup-content h2 {
  color: #0078d7;
}
:root[data-theme="light"] .dot {
  background: #bbb;
}
:root[data-theme="light"] .dot.ok {
  background: #228822;
}
:root[data-theme="light"] #vuMeter {
  background: #e9eaf0;
}
:root[data-theme="light"] #vuMeter .fill {
  background: #0078d7;
}

:root{
  --bg:#0e1116;--fg:#e6e6e6;--muted:#a9b0bd;--card:#15171c;--band:#1a1d23;--accent:#3dd6ff;
}
*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font:15px/1.45 system-ui,Arial}
.topbar{position:sticky;top:0;z-index:5;padding:10px 14px;background:#0b0d12;border-bottom:1px solid #222;display:flex;gap:10px;align-items:center}
h1{margin:0;font-size:18px}
.grid{max-width:1100px;margin:12px auto;padding:0 10px;display:grid;gap:14px;grid-template-columns:1.2fr .9fr}
@media (max-width:1000px){.grid{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid #2a2f3a;border-radius:10px;box-shadow:0 4px 14px rgba(0,0,0,.35);padding:12px}
.row{display:flex;gap:10px;align-items:center}.between{justify-content:space-between}
.now{box-shadow:inset 0 0 24px rgba(80,160,255,.2)}
.now-flex{display:flex;gap:14px;align-items:flex-start}
.kv .k{display:inline-block;min-width:88px;color:var(--muted);margin-right:8px}
.kv .v{font-weight:600}
audio{width:100%}.audio{min-width:260px;max-width:340px}.muted{margin-top:6px;color:var(--muted);font-size:12px}
.table-wrap{max-height:60vh;overflow:auto;overflow-x:visible; /* allow table to grow, not scroll horizontally */ }
table {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto; /* let columns size naturally */
}
.compact th, .compact td {
  padding: 6px;
  text-align: center;
  border-bottom: 1px solid #222;
  word-break: break-word;
  white-space: normal; /* allow wrapping */
}

/* Let the Name column wrap freely on all screens */
.compact td:nth-child(4),
.compact th:nth-child(4) {
  white-space: normal !important;
  word-break: break-word;
}

/* Remove forced nowrap from other columns if present */
.compact td,
.compact th {
  white-space: normal;
  word-break: break-word;
}

.btn{border:1px solid #333;background:#222;color:#ddd;padding:6px 10px;border-radius:8px;cursor:pointer}
.btn:hover{border-color:var(--accent)}
.dot{width:10px;height:10px;border-radius:50%;background:#777}.dot.ok{background:#2ecc71}
.foot{color:var(--muted);text-align:center;padding:10px 0}
.tg-chip{display:inline-block;width:.8em;height:.8em;border-radius:50%;vertical-align:-.1em;margin-right:.3em;box-shadow:0 0 10px currentColor}
.badge{
  display:inline-flex; align-items:center; gap:.45em;
  font-size:12px; padding:3px 8px; border-radius:999px;
  border:1px solid #2a2f3a; background:#161a22; color:#a9b0bd;
}
.badge .dot{width:8px; height:8px}
.badge.live{color:#c9f7d3; border-color:#285; background:#112015}
.badge.live .dot{background:#2ecc71; box-shadow:0 0 8px rgba(46,204,113,.75)}
.badge.idle{color:#a9b0bd; border-color:#333; background:#15171c}

/* Name badge with glow */
.badge-name {
  display: inline-block;
  padding: 2px 10px;
  border-radius: 999px;
  font-weight: 600;
  font-size: 13px;
  background: #23273a;
  color: #fff;
  box-shadow: 0 0 8px 2px rgba(61,214,255,0.18);
  border: 1px solid #2a2f3a;
  margin: 0 2px;
  vertical-align: middle;
  transition: box-shadow 0.2s;
}

/* Unique colors for each type */
.badge-ems { background: #4b2a14; color: #fff; box-shadow: 0 0 8px 2px #ffab3d7c; border-color: #ff7b00; }
.badge-pd  { background: #1a2a1a; color: #fff; box-shadow: 0 0 8px 2px #2e8dcc77; border-color: #009dff; }
.badge-fd  { background: #3a1a1a; color: #fff; box-shadow: 0 0 8px 2px #ff3d3d77; border-color: #ff3d3d; }
.badge-dot { background: #2a1a3a; color: #fff; box-shadow: 0 0 8px 2px #b86bff77; border-color: #b86bff; }
.badge-dns { background: #1a3a1c; color: #fff; box-shadow: 0 0 8px 2px #4dff6577; border-color: #4dff5c; }
.badge-ast { background: #1c1a2a; color: #fff; box-shadow: 0 0 8px 2px #4d68ff77; border-color: #4d71ff; }

.now.idle{opacity:.6} /* dim the whole card when idle */

/* optional: pulsing dot when live */
@keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.25)} 100%{transform:scale(1)} }
.badge.live .dot{animation:pulse 1.6s ease-in-out infinite}

/* 1) Let the "Now Talking" row wrap on small screens */
.now-flex{
  display:flex;
  gap:14px;
  align-items:flex-start;
  flex-wrap: wrap;              /* <-- allow wrapping */
}

/* 2) Make the key/value block and audio block flex nicely */
.kv{ flex: 1 1 260px; min-width: 0; }     /* grow, but don’t force width */
.audio{ flex: 1 1 260px; min-width: 0; }  /* drop fixed min/max on narrow screens */
@media (max-width: 700px){
  .audio{ max-width: 100%; }              /* full width when wrapped */
}

/* 3) Prevent long values from pushing layout horizontally */
.kv .k, .kv .v{
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;          /* keeps a single line with ellipsis */
}
@media (max-width: 480px){
  /* allow wrapping on very small phones so more info is visible */
  .kv .k, .kv .v{ white-space: normal; word-break: break-word; }
  .kv .k{ min-width: 72px; }    /* slightly smaller label width on tiny screens */
}

/* 4) Table: ensure it never causes horizontal scroll */
.table-wrap{
  max-height: 60vh;
  overflow:auto;
  overflow-x:visible; /* allow table to grow, not scroll horizontally */
}
table {
  width: 100%;
  border-collapse: collapse;
  table-layout: auto; /* let columns size naturally */
}
.compact th, .compact td {
  padding: 6px;
  text-align: center;
  border-bottom: 1px solid #222;
  word-break: break-word;
  white-space: normal; /* allow wrapping */
}

/* Let the Name column wrap freely on all screens */
.compact td:nth-child(4),
.compact th:nth-child(4) {
  white-space: normal !important;
  word-break: break-word;
}

/* Remove forced nowrap from other columns if present */
.compact td,
.compact th {
  white-space: normal;
  word-break: break-word;
}
@media (max-width: 480px){
  /* Let the Name column wrap; keep numeric columns tight */
  .compact td:nth-child(4),
  .compact th:nth-child(4){ white-space: normal; }
}

/* 5) Grid: single column kicks in at 1000px already — keep it */
@media (max-width:1000px){
  .grid{ grid-template-columns:1fr; }
}

/* 6) Last-resort guard: never allow page-wide horizontal scroll */
html, body{ max-width:100%; overflow-x:hidden; }

@media (max-width: 480px){
  .card{ padding:10px; }
  .compact th, .compact td{ padding:5px; font-size:14px; }
}

@media (max-width: 360px){
  /* Hide Source and Enc to avoid horizontal squeeze */
  .compact th:nth-child(5), .compact td:nth-child(5),
  .compact th:nth-child(6), .compact td:nth-child(6){ display:none; }
}

.kv .v, .compact td { overflow-wrap:anywhere; }

.audio, audio { max-width:100%; }

/* --- Mobile table fixes --- */
@media (max-width: 700px){
  /* slightly smaller text in the table */
  table.compact { font-size: 13px; }

  /* let cells wrap, and make rows grow to fit */
  .compact th, .compact td{
    white-space: normal;            /* allow wrapping */
    word-break: break-word;         /* break long words/IDs if needed */
    overflow-wrap: anywhere;        /* modern fallback */
    line-height: 1.25;              /* more breathing room */
    vertical-align: top;            /* start from the top of the cell */
  }

  /* keep numbers tighter; name can wrap freely */
  .compact td:nth-child(1),
  .compact td:nth-child(2),
  .compact td:nth-child(3),
  .compact td:nth-child(5),
  .compact td:nth-child(6){
    white-space: nowrap;            /* time, freq, tgid, src, enc stay on one line */
  }
  .compact td:nth-child(4),         /* Name column */
  .compact th:nth-child(4){
    white-space: normal;            /* allow wrapping for names */
  }

  /* make sure the colored chip never causes layout issues */
  .tg-chip{
    flex: 0 0 auto;
    width: .8em; height: .8em;
    display: inline-block;
    margin-right: .35em;
  }
}

/* if extremely narrow (tiny phones), relax even more */
@media (max-width: 380px){
  table.compact { font-size: 12px; }
  .compact th, .compact td{ padding: 5px 6px; }
}

.controls{
  display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-top:8px;
}
.controls .btn{ padding:6px 12px; }
.controls .vol{ display:flex; align-items:center; gap:6px; color:var(--muted); }
.controls input[type="range"]{ width:140px; }

/* simple status styles reusing your badge look */
.status { margin-left: 4px; }
.status.ok    { color:#c9f7d3; border-color:#285; background:#112015; }
.status.err   { color:#ffd2d2; border-color:#822; background:#2a1010; }

/* VU meter – stacking + correct width behavior */
#vuMeter{
  position: fixed;
  left: 10px;
  bottom: 10px;
  width: 180px;
  height: 12px;
  background: #333;
  border-radius: 6px;
  overflow: hidden;
  z-index: 2147483647;
  box-shadow: 0 0 6px rgba(0,0,0,.4);
  isolation: isolate;          /* own stacking context */
  pointer-events: none;        /* never capture clicks */
}

#vuMeter .fill{
  position: absolute;
  left: 0;                     /* <-- keep left fixed */
  top: 0;                      /* <-- and pin to top/bottom */
  bottom: 0;
  /* right: auto;              /* <-- DO NOT set right; avoids width constraints */
  width: 0%;                   /* <-- now this animates correctly */
  background: #4caf50;
  transition: width 60ms linear;
  will-change: width;          /* smoother updates */
  z-index: 1;
}

#vuMeter .label{
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  font: 11px/1.2 system-ui, sans-serif;
  color: #ddd;
  opacity: .7;
  z-index: 2;
  pointer-events: none;
}

#vuMeter.error{
  height: 24px;
  color: #fff;
  padding: 0 8px;
}
#vuMeter.error .fill{ display:none; }

.popup-backdrop {
  position: fixed; z-index: 1000; inset: 0;
  background: rgba(0,0,0,0.65);
  display: none; align-items: center; justify-content: center;
  overflow-y: auto; /* allow scrolling if popup is taller than viewport */
}
.popup-card {
  background: #181b22;
  border-radius: 12px;
  box-shadow: 0 8px 32px #000a;
  max-width: 420px;
  width: 95vw;
  padding: 0;
  color: #fff;
  font-size: 15px;
  animation: popupIn 0.2s;
  max-height: 90vh;      /* never exceed 90% of viewport height */
  overflow-y: auto;      /* scroll popup if needed */
}
@keyframes popupIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.popup-tabs {
  display: flex; align-items: center; border-bottom: 1px solid #222;
  background: #23273a; border-radius: 12px 12px 0 0;
}
.tab-btn {
  background: none; border: none; color: #fff; font-weight: 600;
  padding: 12px 18px 10px 18px; cursor: pointer; font-size: 15px;
  border-bottom: 2px solid transparent;
}
.tab-btn.active { border-bottom: 2px solid #3dd6ff; color: #3dd6ff; }
.close-btn {
  margin-left: auto; background: none; border: none; color: #fff;
  font-size: 22px; cursor: pointer; padding: 10px 18px;
}
.popup-content {
  padding: 18px 22px 18px 22px;
  max-height: 65vh;      /* content area scrolls if needed */
  overflow-y: auto;
}
.tab-content { display: none; }
.tab-content.active { display: block; }
@media (max-width: 600px) {
  .popup-card { max-width: 98vw; font-size: 14px; }
  .popup-content { padding: 12px 6vw; max-height: 70vh; }
}

.popup-card b {
  color: var(--accent);
  font-weight: 700;
}

/* Optionally, make About/Policy section headers even more distinct */
.popup-content h2 {
  color: #3dd6ff;
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

.update-notice {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0; right: 0;
  background: #3dd6ff;
  color: #222;
  padding: 14px 56px 14px 18px;
  text-align: center;
  z-index: 9999;
  font-size: 16px;
  box-shadow: 0 -2px 16px #0004;
  border-top: 1px solid #2a2f3a;
  border-radius: 0 0 10px 10px;
  font-weight: 500;
  letter-spacing: 0.01em;
}

.update-notice-close {
  position: absolute;
  right: 16px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  font-size: 26px;
  cursor: pointer;
  color: #222;
  opacity: 0.7;
  transition: opacity 0.15s;
  padding: 0 8px;
  line-height: 1;
}
.update-notice-close:hover,
.update-notice-close:focus {
  opacity: 1;
  color: #000;
  background: #fff3;
  border-radius: 50%;
  outline: none;
}

/* Responsive: slightly smaller on mobile */
@media (max-width: 600px) {
  .update-notice { font-size: 14px; padding: 12px 44px 12px 10px; }
  .update-notice-close { right: 8px; font-size: 22px; }
}

#outdatedWarning {
  display: none;
  margin: 10px 0 0 0;
  background: #ffb84d;
  color: #222;
  padding: 8px 0;
  text-align: center;
  font-size: 15px;
  font-weight: 500;
  border-radius: 6px;
}

#outdatedWarning.muted {
  background: none;
  color: var(--muted);
  font-weight: 400;
  border-radius: 0;
  padding: 0;
  margin: 8px 0 0 0;
  font-size: 13px;
  box-shadow: none;
}

